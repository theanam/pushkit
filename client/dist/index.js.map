{"version":3,"sources":["index.js"],"names":["_log","msg","console","log","toUint8Array","base64String","padding","base64","repeat","length","replace","rawData","window","atob","outputArray","Uint8Array","i","charCodeAt","getSubStatus","reg","Promise","resolve","reject","pushManager","getSubscription","then","sub","catch","requestPushSubscription","key","applicationServerKey","subscribe","userVisibleOnly","PushKit","publicKey","verbose","Error","supported","subscribed","navigator","handleRegistration","e"],"mappings":";AAkEC,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,QAAA,EAjED,IAAMA,EAAO,SAACC,GAAQC,OAAAA,QAAQC,IAAIF,IAClC,SAASG,EAAaC,GAKhB,IAJCC,IACAC,GAAeF,EADD,IAAIG,QAAQ,EAAIH,EAAaI,OAAS,GAAK,IAClBC,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KACxEC,EAAcC,OAAOC,KAAKN,GAC1BO,EAAc,IAAIC,WAAWJ,EAAQF,QAClCO,EAAI,EAAGA,EAAIL,EAAQF,SAAUO,EACpCF,EAAYE,GAAKL,EAAQM,WAAWD,GAE/BF,OAAAA,EAER,SAASI,EAAaC,GACd,OAAA,IAAIC,QAAQ,SAACC,EAAQC,GAC3BH,EAAII,YAAYC,kBACdC,KAAK,SAAAC,GACFA,OAAQ,OAARA,EAAqBJ,EAAO,MACnBD,EAAQK,KAEpBC,MAAML,KAGV,SAASM,EAAwBT,EAAIU,GAC7B,OAAA,IAAIT,QAAQ,SAACC,EAAQC,GACvBQ,IAAAA,EAAuB1B,EAAayB,GACxCV,EAAII,YAAYQ,UAAU,CACzBC,iBAAiB,EACjBF,qBAAAA,IACEL,KAAKJ,GAASM,MAAML,KAMlB,SAASW,EAAQC,GAA2B,IAAA,EAAA,KAAhBC,EAAU,UAAA,OAAA,QAAA,IAAA,UAAA,IAAA,UAAA,GACzC,IAACD,GAAkC,iBAAdA,EAAwB,MAAM,IAAIE,MAAM,uCAC3DC,KAAAA,WAAa,EACbC,KAAAA,YAAa,EACbT,KAAAA,IAAaK,EACbf,KAAAA,IAAa,KACbO,KAAAA,IAAa,KACZ,kBAAmBa,WAAgB,gBAAiB3B,SAAS,KAAKyB,WAAY,GAC/EG,KAAAA,mBAAqB,SAACrB,GACvB,IAACA,EAAK,MAAM,IAAIiB,MAAM,2DAClB,OAAA,IAAIhB,QAAQ,SAAAC,GACf,IAAmB,IAAnB,EAAKgB,UAAqB,OAAOhB,EAAQ,MAC5C,EAAKF,IAAMA,EACXD,EAAa,EAAKC,KAAKM,KAAK,SAAAC,GAIpBL,OAHP,EAAKK,IAAaA,EAClB,EAAKY,YAAa,EACfH,GAASnC,EAAK,2BACVqB,EAAQ,EAAKK,OAClBC,MAAM,SAAAc,GACLN,GAASnC,EAAKyC,GACjBb,EAAwB,EAAKT,IAAI,EAAKU,KAAKJ,KAAK,SAAAC,GAIxCL,OAHP,EAAKK,IAAaA,EAClB,EAAKY,YAAa,EACfH,GAASnC,EAAK,2BACVqB,EAAQ,EAAKK,OAClBC,MAAM,SAAAc,GAEDpB,OADJc,GAASnC,EAAKyC,GACVpB,EAAQ","file":"index.js","sourceRoot":"..","sourcesContent":["/// <reference types=\"./index\" />\nconst _log = (msg) => console.log(msg);\nfunction toUint8Array(base64String) {\n\tconst padding     = '='.repeat((4 - base64String.length % 4) % 4);\n\tconst base64      = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');\n\tconst rawData     = window.atob(base64);\n\tconst outputArray = new Uint8Array(rawData.length);\n\tfor (let i = 0; i < rawData.length; ++i) {\n\t  outputArray[i] = rawData.charCodeAt(i);\n\t}\n\treturn outputArray;\n}\nfunction getSubStatus(reg){\n\treturn new Promise((resolve,reject)=>{\n\t\treg.pushManager.getSubscription()\n\t\t\t.then(sub=>{\n\t\t\t\tif(sub === null) return reject(null);\n\t\t\t\telse return resolve(sub);\n\t\t\t})\n\t\t\t.catch(reject);\t\n\t})\n}\nfunction requestPushSubscription(reg,key){ \n\treturn new Promise((resolve,reject)=>{\n\t\tlet applicationServerKey = toUint8Array(key);\n\t\treg.pushManager.subscribe({\n\t\t\tuserVisibleOnly: true,\n\t\t\tapplicationServerKey\n\t\t}).then(resolve).catch(reject);\n\t})\n}\n/**\n * @type {import('./index')}\n */\nexport function PushKit(publicKey, verbose = false){\n\tif(!publicKey || typeof publicKey !== \"string\") throw new Error(\"Public key must be a valid VAPT key\");\n\tthis.supported  = true;\n\tthis.subscribed = false;\n\tthis.key        = publicKey;\n\tthis.reg        = null;\n\tthis.sub        = null;\n\tif (!('serviceWorker' in navigator) || !('PushManager' in window)) this.supported = false;\t\n\tthis.handleRegistration = (reg) =>{\n\t\tif(!reg) throw new Error(\"Service worker registration object required as argument\");\n\t\treturn new Promise(resolve=>{\n\t\t\tif(this.supported === false) return resolve(null);\n\t\t\tthis.reg = reg;\n\t\t\tgetSubStatus(this.reg).then(sub=>{\n\t\t\t\tthis.sub        = sub;\n\t\t\t\tthis.subscribed = true;\n\t\t\t\tif(verbose) _log(\"Already Push Subscribed\");\n\t\t\t\treturn resolve(this.sub);\n\t\t\t}).catch(e=>{\n\t\t\t\tif(verbose) _log(e);\n\t\t\t\trequestPushSubscription(this.reg,this.key).then(sub=>{\n\t\t\t\t\tthis.sub        = sub;\n\t\t\t\t\tthis.subscribed = true;\n\t\t\t\t\tif(verbose) _log(\"Freshly Push Subscribed\");\n\t\t\t\t\treturn resolve(this.sub);\n\t\t\t\t}).catch(e=>{\n\t\t\t\t\tif(verbose) _log(e);\n\t\t\t\t\treturn resolve(null);\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\t}\n}"]}